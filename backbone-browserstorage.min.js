"use strict";!function(t){var o=t._,e=t.Backbone;!function(){var t=[];if(o||t.push("lodash (or underscore)"),e||t.push("Backbone"),t.length>0)throw new Error("Unresolved dependencies: ",t.join(","))}();var r=function(){function o(t,o){r[t]=JSON.stringify(o)}function e(t){var o,e=r[t];try{o=JSON.parse(e)}catch(a){o=e}return o}var r=t.localStorage;return function(t,r){return 2===arguments.length?o(t,r):e(t)}}(),a=e.Model.extend({constructor:function(t,a){var n=this;if(!o.isObject(a))throw new Error("Invalid options object");if("string"!=typeof a.localStorageKey)throw new Error("Invalid localStorageKey in constructor options");this.$localStorageKey=a.localStorageKey,e.Model.apply(this,arguments),this.on("change",function(){n.$updateLocalStorage.apply(n,arguments)}),r(this.$localStorageKey)||r(this.$localStorageKey,[]),this.$updateCollection.call(this)},$updateCollection:function(){this.set(r(this.$localStorageKey))},$updateLocalStorage:function(){var t=this.toJSON();o.isArray(this.lsExcludedAttributes)&&o.each(this.lsExcludedAttributes,function(e){"string"==typeof e?delete t[e]:e instanceof RegExp&&o.forIn(t,function(o,r){e.test(r)&&delete t[r]})}),r(this.$localStorageKey,t),this.trigger("localStorageUpdated")}}),n=e.Collection.extend({constructor:function(t,a){var n=this;if(!o.isObject(a))throw new Error("Invalid options object");if("string"!=typeof a.localStorageKey)throw new Error("Invalid localStorageKey in constructor options");this.$localStorageKey=a.localStorageKey,e.Collection.apply(this,arguments),o.extend(this,e.Events);var l=["reset","change"];a.updateOnlyOnReset!==!0&&(l.push("add"),l.push("remove")),this.on(l.join(" "),function(){n.$updateLocalStorage.apply(n,arguments)}),r(this.$localStorageKey)||r(this.$localStorageKey,[]),this.$updateCollection.call(this)},$updateCollection:function(){this.set(r(this.$localStorageKey))},$updateLocalStorage:function(){this.trigger("localStorageUpdated"),r(this.$localStorageKey,this.toJSON())}});e.LocalStorageModel=e.BrowserStorageModel=a,e.LocalStorageCollection=e.BrowserStorageCollection=n,e.lS=r}(this);
